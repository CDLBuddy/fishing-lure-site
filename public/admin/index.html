<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Admin • RIP Custom Lures</title>
    <meta name="robots" content="noindex, nofollow" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="color-scheme" content="dark light" />
    <!-- Make all relative URLs resolve to /admin/... -->
    <base href="/admin/">

    <!-- Decap runs in the page; we’ll initialize it manually so we can set a config path -->
    <script>window.CMS_MANUAL_INIT = true;</script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <style>
      :root { color-scheme: light dark; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      }

      /* ---------- Owner Guide button ---------- */
      .guide-btn {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 9999;
        background: #0b1220;
        color: #fff;
        padding: 10px 14px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 700;
        border: 1px solid rgba(255,255,255,0.12);
        box-shadow: 0 6px 20px rgba(0,0,0,.35);
        -webkit-tap-highlight-color: transparent;
      }
      .guide-btn:focus-visible { outline: 2px solid #70c2ff; outline-offset: 2px; }

      /* On tablets/phones, move it to a floating FAB at the bottom-right */
      @media (max-width: 900px) {
        .guide-btn {
          top: auto;
          right: max(12px, env(safe-area-inset-right));
          bottom: max(12px, env(safe-area-inset-bottom));
          background: #0b1220e6;
          backdrop-filter: blur(6px) saturate(120%);
          border-radius: 999px;
        }
      }
      /* On very small screens, show just an icon to avoid covering UI */
      @media (max-width: 420px) {
        .guide-btn { padding: 10px; width: 44px; height: 44px; display: grid; place-items: center; }
        .guide-btn .label { position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; } /* Visually hidden, still accessible */
        .guide-btn::before { content: "❓"; font-size: 18px; line-height: 1; }
      }

      /* ---------- Friendly fallback panel if CMS fails ---------- */
      .msg {
        position: fixed; inset: 0; display: grid; place-items: center; padding: 24px;
        color: #111; background: #fff;
      }
      @media (prefers-color-scheme: dark) { .msg { color: #e6edf3; background: #0b1220; } }
      .msg .card {
        max-width: 720px; padding: 20px; border-radius: 12px;
        border: 1px solid rgba(127,127,127,.25);
      }
      .msg h1 { margin: 0 0 8px; font-size: 20px; }
      .msg p { margin: 6px 0; opacity: .9; }
      .msg code { padding: 2px 6px; border-radius: 6px; background: rgba(127,127,127,.15); }
    </style>
  </head>
  <body>
    <a class="guide-btn" href="/owner-guide.html" target="_blank" rel="noopener">
      <span class="label">Owner Guide ↗</span>
    </a>

    <noscript>
      <div class="msg"><div class="card">
        <h1>Enable JavaScript</h1>
        <p>The admin console needs JavaScript to run.</p>
      </div></div>
    </noscript>

    <script>
      (function () {
        const showError = (title, detail) => {
          const wrap = document.createElement('div');
          wrap.className = 'msg';
          wrap.innerHTML = `
            <div class="card">
              <h1>${title}</h1>
              <p>${detail}</p>
              <p>Check that <code>/admin/config.yml</code> exists and is reachable.</p>
            </div>`;
          document.body.appendChild(wrap);
        };

        const boot = () => {
          try {
            CMS.init({ load_config_file: true, config_path: 'config.yml' });
            /* Match site look inside the preview pane */
            CMS.registerPreviewStyle('/styles/tokens.css');
            CMS.registerPreviewStyle('/styles/base.css');
            CMS.registerPreviewStyle('/admin/preview.css');
          } catch (e) {
            showError('Admin failed to start', e?.message || 'Unknown error');
          }
        };

        // Wait for the CMS global to be present, then init
        let tries = 0;
        const tick = setInterval(() => {
          tries++;
          if (window.CMS && typeof CMS.init === 'function') {
            clearInterval(tick);
            boot();
          } else if (tries > 200) {
            clearInterval(tick);
            showError('Admin failed to load', 'The CMS script did not initialize.');
          }
        }, 50);
      })();
    </script>
  </body>
</html>